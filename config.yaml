# MAPA_FRENTES - Configuracion
# Herramienta para generar mapas de frentes meteorologicos

area:
  lon_min: -70.0
  lon_max: 40.0
  lat_min: 25.0
  lat_max: 65.0
  data_padding_deg: 10.0   # Grados extra para descarga de datos (cubre esquinas Lambert)

isobars:
  interval_hpa: 4
  smooth_sigma: 2.0
  linewidth: 0.6
  color: "#333333"
  label_fontsize: 6

pressure_centers:
  filter_size: 9            # puntos de ventana para min/max filter (~5deg a 0.25deg)
  min_distance_deg: 4.5     # menos centros secundarios (más estilo sinóptico)
  secondary_radius_deg: 5.0 # radio para clasificar primario/secundario
  high_min_pressure: 1012.0 # no marcar H si presion < este valor (hPa)
  low_max_pressure: 1012.0  # no marcar L si presion > este valor (hPa)
  min_depth_hpa: 1.0        # profundidad minima (dif. con presion media entorno)
  depth_radius_deg: 3.0     # radio para calcular presion media del entorno
  h_color: "#0044CC"
  l_color: "#CC0000"
  fontsize: 11
  fontweight: "bold"
  high_label: "A"            # etiqueta para anticiclon (estilo AEMET)
  low_label: "B"             # etiqueta para borrasca (estilo AEMET)

tfp:
  smooth_sigma: 8.0                # FUERTE: elimina ruido subsinotico (Sansom&Catto usan ~96 pases a 0.25deg)
  gradient_threshold: 2.5e-6       # ALTO: solo zonas baroclinas fuertes (frentes reales)

  # detección (legacy DBSCAN - solo si use_contour_method: false)
  dbscan_eps_deg: 3.0
  dbscan_min_samples: 3
  min_front_points: 6              # mínimo 6 vértices por segmento de contorno

  # geometría
  simplify_tolerance_deg: 0.25
  max_hop_deg: 3.0
  angular_weight: 0.60
  spline_smoothing: 0.5            # suavizado spline más fuerte para frentes más lisos
  merge_distance_deg: 2.0

  # filtros físicos
  use_mslp_filter: true
  mslp_laplacian_sigma: 6.0        # suavizado MSLP sinóptico

  use_frontogenesis_filter: true
  frontogenesis_percentile: 8

  min_front_length_deg: 5.0        # SOLO frentes largos (sinópticos, no mesoescala)
  max_fronts: 30                   # AEMET dibuja ~15-20 en todo el dominio

  # Método de extracción: contour-then-mask (Sansom & Catto 2024)
  use_contour_method: true

  # Diagnóstico F (Parfitt et al. 2017): F = (|grad_T|/escala) * (|vor|/|f|)
  # Filtra gradientes termicos sin actividad dinámica (costas, orografia)
  use_f_diagnostic: true
  f_diagnostic_threshold: 0.15      # moderado: requiere gradiente Y vorticidad significativos

  # Boost por vorticidad: reduce umbral de gradiente donde |vo850| es alto
  use_vorticity_boost: true
  vorticity_boost_threshold: 5.0e-5
  vorticity_boost_factor: 0.5       # threshold * 0.5 = 1.25e-6 en zonas de alta vorticidad

plotting:
  figsize: [18, 11]
  dpi: 150
  projection: "LambertConformal"
  projection_params:
    central_longitude: -15.0
    central_latitude: 45.0
    standard_parallels: [30.0, 60.0]
  coastline_color: "#555555"
  coastline_linewidth: 0.6
  border_color: "#AAAAAA"
  border_linewidth: 0.3
  ocean_color: "#D6EAF8"
  land_color: "#F5F0E8"
  front_linewidth: 1
  front_symbol_size: 1.6
  front_symbol_spacing: 1.9

center_fronts:
  search_radius_deg: 6.5
  trace_step_deg: 0.5
  max_front_length_deg: 16
  max_turn_deg: 55              # permite curvatura natural
  gradient_cutoff_factor: 0.25
  spline_smoothing: 0.35
  max_association_distance_deg: 8
  require_low_center: true       # solo frentes cerca de centros L (borrascas)
  max_distance_to_low_deg: 12.0  # radio maximo alrededor de cada L

temporal:
  enabled: true
  context_steps: [-6, -3, 0, 3, 6]
  match_distance_deg: 2.5
  min_persistence: 3             # 4 era muy estricto; 3 se parece más a “criterio humano”

instability_lines:
  enabled: true
  smooth_sigma: 5.0
  convergence_threshold: 3.5e-5
  min_length_deg: 3.0

export:
  default_format: "png"
  png_dpi: 300
  pdf_dpi: 150

data:
  cache_dir: "data/cache"
  output_dir: "data/output"
  sessions_dir: "data/sessions"

ecmwf:
  source: "aws"
  model: "ifs"
  resol: "0p25"
  step: 0
  surface_params:
    - "msl"
    - "tp"
  pressure_levels: [500, 700, 850]
  pressure_params:
    - "t"
    - "q"
    - "u"
    - "v"
    - "vo"  # vorticidad relativa

background_field:
  default_field: "none"      # "none", "theta_e_850", "grad_theta_e_850",
                             # "thickness_1000_500", "temp_advection_850", "wind_speed_850"
  alpha: 0.45                # transparencia del contourf
  num_levels: 20             # numero de niveles de contorno
  colorbar: true             # mostrar colorbar

precipitation:
  threshold_mm: 0.5      # no dibujar por debajo de este valor (transparente)
  alpha: 0.5             # transparencia del contourf
  cmap: "YlGnBu"         # colormap
  num_levels: 15          # niveles de contorno

wind_vectors:
  thin_factor: 5         # cada N puntos de la rejilla (0.25deg * 8 = 2deg)
  scale: 6000             # escala del quiver (mayor = flechas mas cortas)
  width: 0.0005           # grosor de las flechas
  color: "#555555"       # color de las flechas
  alpha: 1.0             # transparencia (1.0 = opaco)
  web_scale_factor: 0.1 # multiplicador de scale para web (mayor = flechas mas cortas en web)
  web_width_factor: 0.6  # multiplicador de width para web (menor = mas finas en web)

occlusion:
  enabled: true
  min_score: 0.60
  vsi_threshold: 0.10
  vorticity_threshold: 8.0e-5
  t_pattern_radius_deg: 5.0
  t_pattern_max_angle: 90.0
  use_multilevel: true
